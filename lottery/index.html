<!DOCTYPE html>
<html lang="zh-Hans">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width">
    <title>作品二</title>
    <link rel="shortcut icon" href="../img/favicon.ico">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="css/loading.css" rel="stylesheet" type="text/css" />
    <link href="css/materialize.min.css" rel="stylesheet" type="text/css" />
    <link href="css/jquery.scrollbar.css" rel="stylesheet" type="text/css" />
    <link href="css/style.css" rel="stylesheet" type="text/css" />
</head>

<body>
    <div id="load"></div>
    <div class="mainBg"></div>
    <div class="mainBgFliter mainBgFliter1"></div>
    <div class="mainBgFliter mainBgFliter2"></div>
    <div class="mainBgFliter mainBgFliter3"></div>
    <div class="mainBgFliter mainBgFliter4"></div>
    <div class="mainBgFliter mainBgFliter5"></div>
    <div class="mainBgFliter mainBgFliter6"></div>
    <div class="mainBgFliter mainBgFliter7"></div>
    <div id="loginPage">
        <div class="container row">
            <div class="col s12 m6 offset-m3 l4 offset-l4">
                <div id="firstChild" class="center" style="position:relative;">
                    <img src="images/close.png" class="responsive-img right" id="close" />
                    <i class="small material-icons myform">person_pin</i>
                </div>
                <div class="input-field col s12 myform">
                    <input placeholder="请输入平台帐号" id="account" type="text" class="validate">
                    <label for="account">账号</label>
                </div>
                <div class="input-field col s12 myform">
                    <input placeholder="请输入平台密码" id="password" type="password" class="validate">
                    <label for="password">密码</label>
                </div>
                <div class="center myform">
                    <button class="btn waves-effect waves-light" id="demoLogin">登录</button>
                </div>
            </div>
        </div>
    </div>
    <main>
        <div id="loginBefore" class="loginBefore">
            <div class="container">
                <div class="loginBeforeBg float10">
                    <img class="responsive-img light light1" src="images/lightOrigin.png" alt="">
                </div>
                <div class="loginBeforeBg float5">
                    <img class="responsive-img light light2" src="images/lightOrigin.png" alt="">
                </div>
                <div class="loginBeforeBg spot1 float5"></div>
                <div class="loginBeforeBg spot2 float10"></div>
                <div class="loginBeforeBg spot3 float30"></div>
                <div id="titleBlock">
                    <img src="images/title.png" class="responsive-img" id="title" />
                </div>
                <div id="joinbtnBlock" class="center-align">
                    <button class="loginBtn">
                        <img src="images/joinBtn.png" class="responsive-img" id="loginBtn" />
                    </button>
                </div>
            </div>
        </div>
        <div id="loginAfter" class="loginAfter" style="display: none;">
            <div id="logoutBlock">
                <div class="container row">
                    <div class="input-field col s9 left-align">
                        <span id="name" class="white-text"></span>
                        <a href="#!" class="blue-text text-lighten-2" onclick="reloadPage()">登出</a>
                    </div>
                    <div class="col s3 right-align">
                        <img data-target="modal1" src="images/listBtn.png" class="modal-trigger responsive-img"
                            id="listBtn" />
                    </div>
                </div>
            </div>
            <div class="container lotteryContainer">
                <span class="spots topRight topRight1"></span>
                <span class="spots topRight topRight2"></span>
                <span class="spots bottomRight bottomRight1"></span>
                <span class="spots bottomRight bottomRight2"></span>
                <span class="spots bottomLeft bottomLeft1"></span>
                <span class="spots bottomLeft bottomLeft2"></span>
                <span class="spots topLeft topLeft1"></span>
                <span class="spots topLeft topLeft2"></span>
                <div id="lotteryBlock" class="lotteryBlock">
                    <div class="lotteryLogo">
                        <img id="lotteryLogo" class="responsive-img" src="images/lotteryLogo.png" alt="" />
                    </div>
                    <div class="outer KinerLottery KinerLotteryContent">
                        <div class="innerWhite"></div>
                        <img src="images/inside.png" class="responsive-img">
                    </div>
                    <div class="inner KinerLotteryBtn start"></div>
                </div>
                <span id="showPrize" class='yellow-text text-lighten-2'></span>
                <div class="resultBlock">
                    <img class="borderLight borderLightTop" src="images/borderLight.png" alt="">
                    <img class="borderLight borderLightRight" src="images/borderLight.png" alt="">
                    <img class="borderLight borderLightBottom" src="images/borderLight.png" alt="">
                    <img class="borderLight borderLightLeft" src="images/borderLight.png" alt="">
                    <p class="white-text center-align">当前流水累计：<span class="betAmount"></span>元，可抽奖<span
                            class="playTimesLeft">0</span>次</p>
                </div>
            </div>
        </div>
        <div id="ruleBlock" class="row">
            <div class="col s10 m7 l8 offset-s1">
                活动规则：
                <br> 1.投注流水满20,000元，可进行幸运转盘1次，投注后10分钟内更新，请重新整理页面
                <br> 2.转盘使用时间为10月18日-11月3日23:59，超过时间未使用视同放弃
                <br> 3.转盘礼金将于11月4日起1-3工作日进行派发
                <br> 4.禁止一切作弊行为，经发现将取消参与资格，平台拥有本次活动最终解释权和裁决权
            </div>
            <div class="col s10 m5 l4 offset-s1">
                <footer>
                    <img class="responsive-img" src="images/footer.png"
                        alt="All rights reserved.Copyright © 2019 ub8 entertainment Inc. " />
                </footer>
            </div>
        </div>
    </main>
    <div id="modal1" class="modal">
        <div class="scrollbar-inner">
            <div class="modal-header">
                <img src="images/close.png" class="modal-close right" />
            </div>
            <div class="modal-content" id="record_content">
            </div>
        </div>
    </div>
    </div>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="js/materialize.min.js"></script>
    <script type="text/javascript" src="js/fingerprint2.min.js"></script>
    <script type="text/javascript" src="js/api_lib.js"></script>
    <script type="text/javascript" src="js/TweenMax.min.js"></script>
    <script type="text/javascript" src="js/pace.min.js"></script>
    <script src="js/kinerLottery.js"></script>
    <script type="text/javascript" src="js/jquery.scrollbar.min.js"></script>
    <script src="js/main.js"></script>
    <script type="text/javascript">
        // ---- 模擬用戶資料與前端 mock API ----
        const demoUser = {
            name: "Demo用户",
            betAmount: 25000,
            playTimesLeft: 1,
            records: [
                { amount: 500, recordTime: new Date().toISOString() }
            ]
        };

        // 模擬 frequency API：更新可抽次數與按鈕狀態
        function frequency() {
            // update UI like the real API would
            $('.playTimesLeft').text(demoUser.playTimesLeft);
            if (demoUser.playTimesLeft > 0) {
                $('.KinerLotteryBtn').removeClass('completed').addClass('start');
            } else {
                $('.KinerLotteryBtn').removeClass('start').addClass('completed');
            }
        }

        // 模擬 queryLotteryInfo API：填充過去抽獎紀錄
        function query_record() {
            var list = demoUser.records || [];
            var str = '';
            if (list.length > 0) {
                $("#listBtn").css("visibility", "visible");
                $.each(list, function (i, item) {
                    str += '<dl>' +
                        '<dd>' + (i + 1) + '</dd>' +
                        '<dd class="yellow-text text-lighten-3">￥' + item.amount + '</dd>' +
                        '<dd>' + (new Date(item.recordTime)).toLocaleString() + '</dd>' +
                        '</dl>';
                });
            } else {
                str = '<p class="center-align">暂无记录</p>';
            }
            $('#record_content').html(str);
        }



        // 模擬登入處理（保留 UI 轉場）
        function handleDemoLogin() {
            const account = $("#account").val() || "demo";
            if (account.trim() === "") {
                M.toast({ html: '请输入帐号', classes: 'rounded' });
                return;
            }

            // 隱藏登入頁面
            TweenMax.to("#loginPage", 1, { opacity: 0 });
            $("#loginPage").css("z-index", 0);

            // 顯示登入後頁面
            $("#loginBefore").hide();
            $("#loginAfter").show();
            $("#logoutBlock").show();
            resultBlockAnimation.play();

            // 更新用戶資訊
            $("#name").text("欢迎, " + demoUser.name);
            $(".betAmount").text(demoUser.betAmount);
            $(".playTimesLeft").text(demoUser.playTimesLeft);

            // run initial mock API updates
            frequency();
            query_record();
        }

        $(function () {
            // 綁定模擬登入按鈕
            $("#demoLogin").on("click", handleDemoLogin);

            // modal & scrollbar init
            $(".modal").modal({
                opacity: 0.8
            });
            $('.scrollbar-inner').scrollbar();

            // simple UI handlers
            $("#close").hover(
                function () { $(this).attr("src", "images/closeHover.png"); },
                function () { $(this).attr("src", "images/close.png"); }
            );

            $(".loginBtn").on("click", function () {
                TweenMax.to("#loginPage", 1, { opacity: 1 });
                $("#loginPage").css("z-index", 20);
            });

            $("#close").on("click", function () {
                TweenMax.to("#loginPage", 1, { opacity: 0 });
                $("#loginPage").css("z-index", 0);
                $(".redAlert").hide();
            });

            // parallax handler
            $("body").mousemove(function (e) {
                parallaxIt(e, ".float3", -30);
                parallaxIt(e, ".float5", -50);
                parallaxIt(e, ".float8", -80);
                parallaxIt(e, ".float10", -100);
                parallaxIt(e, ".float15", -150);
                parallaxIt(e, ".float30", -300);
            });

            function parallaxIt(e, target, movement) {
                var $this = $("body");
                var relX = e.pageX - $this.offset().left;
                var relY = e.pageY - $this.offset().top;

                TweenMax.to(target, 1, {
                    x: (relX - $this.width() / 2) / $this.width() * movement,
                    y: (relY - $this.height() / 2) / $this.height() * movement
                });
            }

            // 監聽抽獎按鈕（依角度決定獎項，共 8 個扇區）
            var whichAward = function (deg) {
                deg = Number(deg);
                if ((deg > 0 && deg <= 45)) {
                    return "8元";
                } else if ((deg > 45 && deg <= 90)) {
                    return "18元";
                } else if (deg > 90 && deg <= 135) {
                    return "58元";
                } else if (deg > 135 && deg <= 180) {
                    return "188元";
                } else if (deg > 180 && deg <= 225) {
                    return "588元";
                } else if (deg > 225 && deg <= 270) {
                    return "1088元";
                } else if (deg > 270 && deg <= 315) {
                    return "18888元";
                } else if (deg > 315 && deg <= 360) {
                    return "再接再厉";
                }
                return "再接再厉";
            };

            $(document).on('click', '.KinerLotteryBtn.start', function () {
                bgFilter.paused(true);
                TweenMax.staggerTo(".mainBgFliter", 4, { css: { 'background-position-y': '+=10800px' }, ease: Elastic.easeInOut.config(1, 1) }, 0.2);
                if (demoUser.playTimesLeft <= 0) {
                    M.toast({ html: '没有抽奖次数', classes: 'rounded' });
                    return;
                }

                // prevent double click
                $('.KinerLotteryBtn').removeClass('start').addClass('running');

                // choose a random sector 0..7 and compute target degree (middle of sector)
                var sectorIndex = Math.floor(Math.random() * 8);
                var sectorStart = sectorIndex * 45; // 0,45,90,...
                var sectorEnd = sectorStart + 45;
                var targetDeg = (sectorStart + sectorEnd) / 2; // center angle

                // compute final rotation so the wheel appears to stop at targetDeg at the pointer (top)
                var spins = 6; // full rotations
                var finalRotation = spins * 360 + (360 - targetDeg);

                // animate wheel to finalRotation
                TweenMax.to('.outer.KinerLottery', 4, { rotation: finalRotation, transformOrigin: '50% 50%', ease: Power4.easeOut });
                // try to play original animations (if defined)
                try { lotteryAnimation.restart(); } catch (e) { }

                // after spin completes, determine prize by the targetDeg
                setTimeout(function () {
                    bgFilter.play();
                    var prizeName = whichAward(targetDeg);

                    // update demo user and UI
                    var prizeAmount = 0;
                    if (prizeName !== '再接再厉') {
                        // parse numeric part
                        prizeAmount = parseInt(prizeName.replace(/[^0-9]/g, ''), 10) || 0;
                    }

                    if (prizeAmount > 0) demoUser.betAmount += prizeAmount;
                    demoUser.records.unshift({ amount: prizeAmount, recordTime: new Date().toISOString() });
                    if (demoUser.records.length > 20) demoUser.records.pop();

                    // show result text
                    if (prizeAmount > 0) {
                        $('#showPrize').text('恭喜！您中了 ' + prizeName);
                    } else {
                        $('#showPrize').text(prizeName);
                    }

                    demoUser.playTimesLeft = Math.max(0, demoUser.playTimesLeft - 1);
                    $('.playTimesLeft').text(demoUser.playTimesLeft);
                    $('.betAmount').text(demoUser.betAmount);

                    query_record();

                    if (demoUser.playTimesLeft > 0) {
                        $('.KinerLotteryBtn').removeClass('running').addClass('start');
                    } else {
                        $('.KinerLotteryBtn').removeClass('running').addClass('completed');
                    }

                    try { resultBlockAnimation.restart(); } catch (e) { }
                }, 4300);
            });

        });
    </script>
</body>

</html>